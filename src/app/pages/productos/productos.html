<div class="productos-page">
  <div class="header">
    <h2> GestiÃ³n de Productos</h2>
    <button (click)="abrirFormularioAgregar()" class="btn-agregar">
      + Agregar Producto
    </button>
  </div>

  <!-- Barra de bÃºsqueda y ordenamiento -->
  <div class="controles" *ngIf="!cargando && productos.length > 0">
    <div class="busqueda">
      <input 
        type="text" 
        [(ngModel)]="textoBusqueda"
        (ngModelChange)="filtrarProductos()"
        placeholder="ðŸ” Buscar por nombre, tipo o proveedor..."
        class="input-busqueda">
    </div>

    <div class="ordenamiento">
      <label>Ordenar por:</label>
      <button 
        (click)="ordenarPor('nombre')"
        [class.activo]="ordenActual === 'nombre'">
        A-Z
      </button>
      <button 
        (click)="ordenarPor('cantidad')"
        [class.activo]="ordenActual === 'cantidad'">
        Cantidad
      </button>
      <button 
        (click)="ordenarPor('fecha')"
        [class.activo]="ordenActual === 'fecha'">
        Vencimiento
      </button>
    </div>
  </div>

  <!-- Formulario -->
  <div class="formulario" *ngIf="mostrarFormulario">
    <h3>{{ modoEdicion ? ' Editar Producto' : ' Nuevo Producto' }}</h3>
    <div class="campos">
      <div class="campo">
        <label>Nombre: *</label>
        <input type="text" [(ngModel)]="nuevoProducto.nombre" placeholder="Ej: Paracetamol">
      </div>

      <div class="campo">
        <label>Tipo: *</label>
        <select [(ngModel)]="nuevoProducto.tipo">
          <option value="medicamento">Medicamento</option>
          <option value="equipo">Equipo</option>
          <option value="insumo">Insumo</option>
        </select>
      </div>

      <div class="campo">
        <label>Cantidad: *</label>
        <input type="number" [(ngModel)]="nuevoProducto.cantidad" min="0">
      </div>

      <div class="campo">
        <label>Stock MÃ­nimo: *</label>
        <input type="number" [(ngModel)]="nuevoProducto.cantidadMinima" min="0">
      </div>

      <div class="campo">
        <label>Fecha Caducidad: *</label>
        <input type="date" [(ngModel)]="nuevoProducto.fechaCaducidad">
      </div>

      <div class="campo">
        <label>Proveedor: *</label>
        <input type="text" [(ngModel)]="nuevoProducto.proveedor" placeholder="Ej: Farmacia ABC">
      </div>
    </div>

    <div class="botones-formulario">
      <button (click)="guardarProducto()" class="btn-guardar">
        {{ modoEdicion ? ' Actualizar' : ' Guardar' }}
      </button>
      <button (click)="cancelarFormulario()" class="btn-cancelar">
         Cancelar
      </button>
    </div>
  </div>

  <!-- Cargando -->
  <div *ngIf="cargando" class="cargando">
     Cargando productos...
  </div>

  <!-- Sin productos -->
  <div *ngIf="!cargando && productos.length === 0" class="vacio">
     No hay productos. Â¡Agrega el primero!
  </div>

  <!-- Sin resultados de bÃºsqueda -->
  <div *ngIf="!cargando && productos.length > 0 && productosFiltrados.length === 0" class="vacio">
     No se encontraron productos con "{{ textoBusqueda }}"
  </div>

  <!-- Lista de productos -->
  <div class="productos-lista" *ngIf="!cargando && productosFiltrados.length > 0">
    <div class="producto-card" 
         *ngFor="let producto of productosFiltrados"
         [class.stock-bajo]="tieneStockBajo(producto)">
      <div class="producto-header">
        <h3>{{ producto.nombre }}</h3>
        <span class="tipo">{{ producto.tipo }}</span>
      </div>
      <div class="producto-info">
        <p><strong>Cantidad:</strong> {{ producto.cantidad }} unidades</p>
        <p><strong>Stock mÃ­nimo:</strong> {{ producto.cantidadMinima }}</p>
        <p><strong>Proveedor:</strong> {{ producto.proveedor }}</p>
        <p><strong>Vence:</strong> {{ producto.fechaCaducidad | date:'dd/MM/yyyy' }}</p>
      </div>
      
      <!-- Alerta de stock bajo -->
      <div class="alerta" *ngIf="tieneStockBajo(producto)">
         Stock bajo
      </div>
      
      <div class="producto-acciones">
        <button (click)="abrirFormularioEditar(producto)" class="btn-editar">
           Editar
        </button>
        <button (click)="eliminar(producto.id)" class="btn-eliminar">
           Eliminar
        </button>
      </div>
    </div>
  </div>
</div>